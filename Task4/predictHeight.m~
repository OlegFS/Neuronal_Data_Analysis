function heightExtimate = predictHeight(h,spikeFlags)
% Estimate the spikes height via regression
% Betas estimated for the 10 training cells (3577 peaks)
Beta =[ 1.1051;    2.4642;    0.4086];

 
%Beta =[ 1.0002; 17.9086;    0.0526]

peaks = find(spikeFlags>0);

% Estimate the neighbours of each waveform as a regressor
Neighbours = zeros(length(h),1)';
if (peaks(1)-3)>0 && (peaks(end)+3)>0
    p = 0
else 
    p = 2
end

for i=1+p:length(peaks)-p;
   Neighbours(i) = sum(spikeFlags(peaks(i)-3:peaks(i)+3)); % try 6
end

distNeighbours = zeros(length(peaks),1)';
if (peaks(1)-20)<0
    

for i=1+p2:length(peaks)
distNeighbours(i) = sum(n(peaks(i)-20:peaks(i))); % try 6
end

X = [ones(length(h),1) h Neighbours'];
heightExtimate = X*Beta; 
